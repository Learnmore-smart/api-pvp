/* ── Reset & base ──────────────────────────────────────────────────────────── */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --bg:        #f4f5fb;
  --bg2:       #ffffff;
  --bg3:       #eef0f8;
  --border:    #d4d8ee;
  --accent:    #5b4fcf;
  --green:     #2ecc71;
  --yellow:    #e8a000;
  --red:       #e74c3c;
  --blue:      #3b82f6;
  --text:      #1e1e38;
  --text-dim:  #6b7080;
  --radius:    10px;
  --card-pad:  16px;
}

html, body {
  height: 100%;
  background: var(--bg);
  color: var(--text);
  font-family: 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
  font-size: 14px;
  line-height: 1.5;
}

/* ── Screens ────────────────────────────────────────────────────────────────── */
.screen { display: none; }
.screen.active { display: block; }

/* ── Setup screen ──────────────────────────────────────────────────────────── */
#setup-screen {
  display: none;
  min-height: 100vh;
  align-items: center;
  justify-content: center;
  padding: 24px;
}
#setup-screen.active { display: flex; }

.setup-card {
  max-width: 440px;
  width: 100%;
}

.card {
  background: var(--bg2);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: var(--card-pad);
  box-shadow: 0 2px 12px rgba(91,79,207,0.07);
}

.card h1 { font-size: 1.6em; margin-bottom: 4px; color: var(--accent); }
.card h2 { font-size: 0.95em; margin-bottom: 12px; color: var(--text); }

.subtitle { color: var(--text-dim); font-size: 0.88em; margin-bottom: 20px; }

label {
  display: block;
  font-size: 0.82em;
  color: var(--text-dim);
  margin-bottom: 14px;
}

label input {
  display: block;
  width: 100%;
  margin-top: 4px;
  padding: 8px 12px;
  background: var(--bg3);
  border: 1px solid var(--border);
  border-radius: 6px;
  color: var(--text);
  font-size: 0.95em;
}
label input:focus { outline: 2px solid var(--accent); }

.btn-primary {
  width: 100%;
  padding: 10px;
  background: var(--accent);
  color: #fff;
  border: none;
  border-radius: 6px;
  font-size: 1em;
  font-weight: 600;
  cursor: pointer;
  transition: opacity 0.15s;
}
.btn-primary:hover:not(:disabled) { opacity: 0.88; }
.btn-primary:disabled { opacity: 0.5; cursor: not-allowed; }

.btn-ghost {
  padding: 4px 12px;
  background: transparent;
  color: var(--text-dim);
  border: 1px solid var(--border);
  border-radius: 6px;
  cursor: pointer;
  font-size: 0.8em;
}
.btn-ghost:hover { border-color: var(--accent); color: var(--accent); }

.btn-tiny {
  padding: 1px 8px;
  background: transparent;
  color: var(--text-dim);
  border: 1px solid var(--border);
  border-radius: 4px;
  cursor: pointer;
  font-size: 0.72em;
  vertical-align: middle;
  margin-left: 6px;
}
.btn-tiny:hover { border-color: var(--accent); color: var(--accent); }

.error-msg {
  margin-top: 10px;
  padding: 8px 12px;
  background: #fde8e8;
  color: var(--red);
  border-radius: 6px;
  font-size: 0.85em;
}
.error-msg.hidden { display: none; }

.keybind-preview {
  margin-top: 20px;
  padding: 12px;
  background: var(--bg3);
  border-radius: 6px;
  display: flex;
  flex-direction: column;
  gap: 6px;
}
.kb-row {
  display: flex;
  align-items: center;
  gap: 4px;
  flex-wrap: wrap;
}
.key {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 28px; height: 26px;
  background: var(--bg2);
  border: 1px solid var(--border);
  border-radius: 5px;
  font-size: 0.78em;
  font-weight: 600;
  box-shadow: 0 2px 0 var(--border);
  color: var(--text);
}
.key.wide   { width: 60px; }
.key.dir-key { font-size: 0.9em; }
.key-label  { font-size: 0.78em; color: var(--text-dim); margin-left: 4px; }

/* ── Game screen ────────────────────────────────────────────────────────────── */
#game-screen { display: none; height: 100vh; flex-direction: column; overflow: hidden; }
#game-screen.active { display: flex; }

#top-bar {
  flex-shrink: 0;
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 8px 16px;
  background: var(--bg2);
  border-bottom: 1px solid var(--border);
  box-shadow: 0 1px 4px rgba(0,0,0,0.05);
}
.player-name { font-weight: 700; font-size: 1em; }
.player-id   { font-size: 0.72em; color: var(--text-dim); }
.player-id-block { display: flex; flex-direction: column; }
#top-bar .btn-ghost { margin-left: auto; }

/* ── Badges ─────────────────────────────────────────────────────────────────── */
.badge {
  padding: 2px 12px;
  border-radius: 20px;
  font-size: 0.72em;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 1px;
}
.badge-sandbox, .badge-lobby { background: #e0f5ec; color: #1a7a4a; }
.badge-battle   { background: #fde8e8; color: #9b2226; }
.badge-finished { background: #fef9e7; color: #7a6200; }

/* ── Main layout ────────────────────────────────────────────────────────────── */
#game-screen main {
  flex: 1;
  min-height: 0;
  overflow-y: auto;
  padding: 14px;
}

.cols {
  display: flex;
  gap: 12px;
  min-height: 0;
  flex-wrap: wrap;
}

.stats-card  { flex: 0 0 220px; }
.keys-card   { flex: 0 0 240px; }
.log-card    { flex: 1 1 200px; min-width: 160px; }

/* ── Stats card ─────────────────────────────────────────────────────────────── */
.stat-row {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 8px;
}
.stat-label {
  width: 48px;
  font-size: 0.78em;
  color: var(--text-dim);
  flex-shrink: 0;
}
.stat-val {
  min-width: 32px;
  text-align: right;
  font-size: 0.82em;
  font-variant-numeric: tabular-nums;
  color: var(--text);
}
.stat-val.big { font-size: 1.2em; font-weight: 700; color: var(--accent); }
.bar-wrap {
  flex: 1;
  height: 8px;
  background: var(--bg3);
  border-radius: 4px;
  overflow: hidden;
  border: 1px solid var(--border);
}
.bar {
  height: 100%;
  border-radius: 4px;
  transition: width 0.12s;
}
.ammo-pips {
  flex: 1;
  display: flex;
  gap: 4px;
  align-items: center;
}
.pip {
  width: 14px; height: 14px;
  border-radius: 50%;
  background: var(--accent);
  border: 1px solid var(--border);
}
.pip.empty { background: var(--bg3); }

.divider {
  height: 1px;
  background: var(--border);
  margin: 10px 0;
}

.cooldown-row {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}
.indicator {
  padding: 3px 8px;
  background: var(--bg3);
  border: 1px solid var(--border);
  border-radius: 20px;
  font-size: 0.72em;
  color: var(--text-dim);
  transition: background 0.1s, color 0.1s;
}
.indicator.active {
  background: #e0f5ec;
  color: #1a7a4a;
  border-color: #a8d5bd;
}
.indicator.dead {
  background: #fde8e8;
  color: var(--red);
  border-color: #f5b5b5;
}
.indicator.hidden { display: none; }

.last-action {
  font-size: 0.8em;
  padding: 6px 8px;
  background: var(--bg3);
  border-radius: 6px;
  border: 1px solid var(--border);
}
.last-action.ok   { color: var(--green); }
.last-action.err  { color: var(--red); }
.last-action.warn { color: var(--yellow); }
.last-action.info { color: var(--text-dim); }

/* ── Controls card ──────────────────────────────────────────────────────────── */
.key-block { margin-bottom: 12px; }
.key-group-label { font-size: 0.72em; color: var(--text-dim); margin-bottom: 4px; }

.wasd { display: inline-flex; flex-direction: column; align-items: center; gap: 2px; }
.wasd-row { display: flex; gap: 2px; align-items: center; }
.wasd-row.muted { font-size: 0.72em; color: var(--text-dim); margin-top: 2px; }

.kbox {
  display: inline-flex; align-items: center; justify-content: center;
  min-width: 28px; height: 26px; padding: 0 6px;
  background: var(--bg3);
  border: 1px solid var(--border);
  border-radius: 5px;
  font-size: 0.8em;
  font-weight: 600;
  box-shadow: 0 2px 0 var(--border);
  transition: background 0.08s, box-shadow 0.08s, transform 0.05s;
  user-select: none;
  color: var(--text);
}
.kbox.wide   { min-width: 60px; }
.kbox.pressed {
  background: var(--accent);
  color: #fff;
  box-shadow: 0 1px 0 rgba(0,0,0,0.2);
  transform: translateY(1px);
}

.key-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.8em;
}
.key-table td {
  padding: 3px 4px;
  vertical-align: middle;
}
.key-table td:first-child { padding-right: 8px; }
.cost { font-size: 0.78em; color: var(--text-dim); }

/* ── Aim pad ────────────────────────────────────────────────────────────────── */
.aim-section { margin-top: 12px; }
.aim-label { font-size: 0.72em; color: var(--text-dim); margin-bottom: 6px; }
.aim-row { display: flex; align-items: center; gap: 10px; }

#aim-pad {
  width: 80px; height: 80px;
  border-radius: 50%;
  background: var(--bg3);
  border: 2px solid var(--border);
  position: relative;
  cursor: crosshair;
  flex-shrink: 0;
  user-select: none;
}
#aim-pad:hover { border-color: var(--accent); }
#aim-pad.shooting { border-color: var(--accent); background: #edeafc; }

#aim-dot {
  width: 10px; height: 10px;
  border-radius: 50%;
  background: var(--accent);
  position: absolute;
  top: 50%; left: 50%;
  transform: translate(-50%, -50%);
  pointer-events: none;
  transition: left 0.05s, top 0.05s;
}
#aim-line {
  position: absolute;
  top: 50%; left: 50%;
  width: 28px; height: 2px;
  background: var(--accent);
  transform-origin: 0 50%;
  pointer-events: none;
  opacity: 0.6;
  border-radius: 1px;
}

.aim-info { font-size: 0.78em; color: var(--text-dim); }
#aim-angle-display { font-weight: 600; color: var(--accent); }
.aim-hint { font-size: 0.72em; color: var(--text-dim); margin-top: 4px; }

.hint {
  font-size: 0.75em;
  color: var(--text-dim);
  padding: 6px 8px;
  background: var(--bg3);
  border-radius: 6px;
  border-left: 3px solid var(--border);
}

/* ── Log card ───────────────────────────────────────────────────────────────── */
#action-log {
  max-height: 400px;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
  gap: 2px;
  font-size: 0.78em;
}
.log-entry { padding: 2px 4px; border-radius: 4px; }
.log-ok   { color: #1a7a4a; }
.log-err  { color: var(--red); }
.log-warn { color: var(--yellow); }
.log-info { color: var(--text-dim); }
.log-ts   { color: var(--text-dim); margin-right: 6px; font-size: 0.9em; }

/* ── Server links ───────────────────────────────────────────────────────────── */
.server-links {
  display: flex;
  gap: 10px;
  margin-top: 14px;
  flex-wrap: wrap;
}
.server-link {
  padding: 6px 14px;
  background: var(--bg2);
  border: 1px solid var(--border);
  border-radius: 6px;
  font-size: 0.8em;
  color: var(--text-dim);
  text-decoration: none;
}
.server-link:hover { border-color: var(--accent); color: var(--accent); }
